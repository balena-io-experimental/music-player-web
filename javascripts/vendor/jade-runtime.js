define(function(){function e(e){return null!=e&&""!==e}function t(n){return Array.isArray(n)?n.map(t).filter(e).join(" "):n}var exports={};return Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),exports.merge=function(t,n){var r=t["class"],i=n["class"];(r||i)&&(r=r||[],i=i||[],Array.isArray(r)||(r=[r]),Array.isArray(i)||(i=[i]),t["class"]=r.concat(i).filter(e));for(var o in n)"class"!=o&&(t[o]=n[o]);return t},exports.attrs=function(e,n){var r=[],i=e.terse;delete e.terse;var o=Object.keys(e),s=o.length;if(s){r.push("");for(var a=0;s>a;++a){var u=o[a],c=e[u];"boolean"==typeof c||null==c?c&&(i?r.push(u):r.push(u+'="'+u+'"')):0==u.indexOf("data")&&"string"!=typeof c?r.push(u+"='"+JSON.stringify(c)+"'"):"class"==u?n&&n[u]?(c=exports.escape(t(c)))&&r.push(u+'="'+c+'"'):(c=t(c))&&r.push(u+'="'+c+'"'):n&&n[u]?r.push(u+'="'+exports.escape(c)+'"'):r.push(u+'="'+c+'"')}}return r.join(" ")},exports.escape=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},exports.rethrow=function(e){throw e},exports});