define(['angular', 'firebase'], function(angular, Firebase) {
  return function($scope, $location, $firebase, $speechRecognition, $speechSynthetis) {
    var LANG, completeSong, findSong, fireRef, ignoreUtterance, k, recognition, v, _ref, _results;
    fireRef = new Firebase('https://vocalist.firebaseio.com');
    $scope.$watch('songs', function() {
      var remaining, total;
      total = 0;
      remaining = 0;
      $scope.songs.$getIndex().forEach(function(id) {
        var song;
        song = $scope.songs[id];
        if (!song) {
          return;
        }
        total++;
        if (song.completed === false) {
          return remaining++;
        }
      });
      $scope.totalCount = total;
      $scope.remainingCount = remaining;
      $scope.completedCount = total - remaining;
      return $scope.allChecked = remaining === 0;
    }, true);
    $scope.addSong = function() {
      var newSong;
      newSong = $scope.newSong.trim();
      if (!newSong.length) {
        return;
      }
      $scope.songs.$add({
        title: newSong,
        completed: false
      });
      return $scope.newSong = '';
    };
    $scope.editSong = function(id) {
      var editedSong;
      if (id === $scope.playing.songId) {
        return;
      }
      editedSong = $scope.songs[id];
      if (editedSong.completed) {
        return;
      }
      $scope.editedSong = editedSong;
      return $scope.originalSong = angular.extend({}, editedSong);
    };
    $scope.doneEditing = function(id) {
      var title;
      $scope.editedSong = null;
      title = $scope.songs[id].title.trim();
      if (title) {
        return $scope.songs.$save(id);
      } else {
        return $scope.removeSong(id);
      }
    };
    $scope.revertEditing = function(id) {
      $scope.songs[id] = $scope.originalSong;
      return $scope.doneEditing(id);
    };
    $scope.removeSong = function(id) {
      return $scope.songs.$remove(id);
    };
    $scope.toggleCompleted = function(id) {
      var song;
      song = $scope.songs[id];
      song.completed = !song.completed;
      return $scope.songs.$save(id);
    };
    $scope.nextSong = function() {
      var id, song, _ref;
      $scope.stopMusic();
      id = (_ref = $scope.playing) != null ? _ref.songId : void 0;
      song = $scope.songs[id];
      if (song) {
        song.completed = true;
      }
      return setTimeout(function() {
        $scope.startMusic();
        return $scope.$apply();
      }, 1000);
    };
    $scope.startMusic = function() {
      return $scope.playing.$child('shouldPlay').$set(true);
    };
    $scope.stopMusic = function() {
      return $scope.playing.$set({
        shouldPlay: false
      });
    };
    $scope.clearCompletedSongs = function() {
      return angular.forEach($scope.songs.$getIndex(), function(id) {
        if ($scope.songs[id].completed) {
          return $scope.songs.$remove(id);
        }
      });
    };
    $scope.newSong = '';
    $scope.editedSong = null;
    if ($location.path() === '') {
      $location.path('/');
    }
    $scope.location = $location;
    $scope.songs = $firebase(fireRef.child('playlist'));
    $scope.playing = $firebase(fireRef.child('playing'));
    findSong = function(title) {
      $scope.songs.$getIndex().forEach(function(id) {
        var song;
        song = $scope.songs[id];
        if (song.title === title) {
          return id;
        }
      });
    };
    completeSong = function(title) {
      var id, song;
      id = findSong(title);
      if (!id) {
        return;
      }
      song = $scope.songs[id];
      song.completed = !song.completed;
      $scope.toggleCompleted(id);
      $scope.$apply();
      return true;
    };
    LANG = 'en-US';
    $speechRecognition.onstart(function(e) {
      return $speechSynthetis.speak('What songs do you want to play?', LANG);
    });
    $speechRecognition.onerror(function(e) {
      var error;
      error = e.error || '';
      return console.error('An error occurred ' + error);
    });
    $speechRecognition.payAttention();
    $speechRecognition.setLang(LANG);
    $speechRecognition.listen();
    $speechRecognition.onUtterance(function(utterance) {
      return console.log(utterance);
    });
    $scope.recognition = recognition = {};
    $scope.recognition[LANG] = {
      playSong: {
        regex: /^play .+/gi,
        lang: LANG,
        call: function(utterance) {
          var parts;
          parts = utterance.split(' ');
          if (parts.length > 1) {
            $scope.newSong = parts.slice(1).join(' ');
            $scope.addSong();
            return $scope.$apply();
          }
        }
      },
      startMusic: {
        regex: /start.*music/gi,
        lang: LANG,
        call: function(utterance) {
          $scope.startMusic();
          return $scope.$apply();
        }
      },
      stopMusic: {
        regex: /stop.*music/gi,
        lang: LANG,
        call: function(utterance) {
          $scope.stopMusic();
          return $scope.$apply();
        }
      },
      clearCompleted: {
        regex: /clear.*/gi,
        lang: LANG,
        call: function(utterance) {
          $scope.clearCompletedSongs();
          return $scope.$apply();
        }
      },
      next: {
        regex: /next.*/gi,
        lang: LANG,
        call: function(utterance) {
          $scope.nextSong();
          return $scope.$apply();
        }
      },
      listTasks: [
        {
          regex: /^remove .+/gi,
          lang: LANG,
          call: function(utterance) {
            var id, parts, title;
            parts = utterance.split(' ');
            if (parts.length > 1) {
              title = parts.slice(1).join(' ');
              id = findSong(title);
              if (id) {
                $scope.removeSong(id);
                return $scope.$apply();
              }
            }
          }
        }
      ]
    };
    ignoreUtterance = {};
    _ref = recognition[LANG];
    _results = [];
    for (k in _ref) {
      v = _ref[k];
      if (v instanceof Array) {
        continue;
      }
      _results.push(ignoreUtterance[k] = $speechRecognition.listenUtterance(v));
    }
    return _results;
  };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2xvcmVuem8vY2xvdWQvcnVsZW1vdGlvbi9jb2RlL2Zyb250ZW5kLWNsb25vcy9wdWJsaWMvc2NyaXB0cy9hcHAvY29udHJvbGxlcnMvcGxheWxpc3RDdHJsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL2xvcmVuem8vY2xvdWQvcnVsZW1vdGlvbi9jb2RlL2Zyb250ZW5kLWNsb25vcy9zcmMvc2NyaXB0cy9hcHAvY29udHJvbGxlcnMvcGxheWxpc3RDdHJsLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFBLENBQU8sQ0FBRSxTQUFGLEVBQWEsVUFBYixDQUFQLEVBQWtDLFNBQUMsT0FBRCxFQUFVLFFBQVYsR0FBQTtTQUVqQyxTQUFDLE1BQUQsRUFBUyxTQUFULEVBQW9CLFNBQXBCLEVBQStCLGtCQUEvQixFQUFtRCxnQkFBbkQsR0FBQTtBQUNDLFFBQUEseUZBQUE7QUFBQSxJQUFBLE9BQUEsR0FBYyxJQUFBLFFBQUEsQ0FBUyxpQ0FBVCxDQUFkLENBQUE7QUFBQSxJQUVBLE1BQU0sQ0FBQyxNQUFQLENBQWMsT0FBZCxFQUF1QixTQUFBLEdBQUE7QUFDdEIsVUFBQSxnQkFBQTtBQUFBLE1BQUEsS0FBQSxHQUFRLENBQVIsQ0FBQTtBQUFBLE1BQ0EsU0FBQSxHQUFZLENBRFosQ0FBQTtBQUFBLE1BRUEsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFiLENBQUEsQ0FBd0IsQ0FBQyxPQUF6QixDQUFpQyxTQUFDLEVBQUQsR0FBQTtBQUNoQyxZQUFBLElBQUE7QUFBQSxRQUFBLElBQUEsR0FBTyxNQUFNLENBQUMsS0FBTSxDQUFBLEVBQUEsQ0FBcEIsQ0FBQTtBQUNBLFFBQUEsSUFBVSxDQUFBLElBQVY7QUFBQSxnQkFBQSxDQUFBO1NBREE7QUFBQSxRQUdBLEtBQUEsRUFIQSxDQUFBO0FBSUEsUUFBQSxJQUFlLElBQUksQ0FBQyxTQUFMLEtBQWtCLEtBQWpDO2lCQUFBLFNBQUEsR0FBQTtTQUxnQztNQUFB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QyxDQUFuQyxFQUZyQixDQUREO0FBQUE7b0JBL0tEO0VBQUEsRUFGaUM7QUFBQSxDQUFsQyxDQUFBLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUgWyAnYW5ndWxhcicsICdmaXJlYmFzZScgXSwgKGFuZ3VsYXIsIEZpcmViYXNlKSAtPlxuXG5cdCgkc2NvcGUsICRsb2NhdGlvbiwgJGZpcmViYXNlLCAkc3BlZWNoUmVjb2duaXRpb24sICRzcGVlY2hTeW50aGV0aXMpIC0+XG5cdFx0ZmlyZVJlZiA9IG5ldyBGaXJlYmFzZSgnaHR0cHM6Ly92b2NhbGlzdC5maXJlYmFzZWlvLmNvbScpXG5cblx0XHQkc2NvcGUuJHdhdGNoICdzb25ncycsIC0+XG5cdFx0XHR0b3RhbCA9IDBcblx0XHRcdHJlbWFpbmluZyA9IDBcblx0XHRcdCRzY29wZS5zb25ncy4kZ2V0SW5kZXgoKS5mb3JFYWNoIChpZCkgLT5cblx0XHRcdFx0c29uZyA9ICRzY29wZS5zb25nc1tpZF1cblx0XHRcdFx0cmV0dXJuIGlmIG5vdCBzb25nXG5cblx0XHRcdFx0dG90YWwrK1xuXHRcdFx0XHRyZW1haW5pbmcrKyBpZiBzb25nLmNvbXBsZXRlZCA9PSBmYWxzZVxuXG5cdFx0XHQkc2NvcGUudG90YWxDb3VudCA9IHRvdGFsXG5cdFx0XHQkc2NvcGUucmVtYWluaW5nQ291bnQgPSByZW1haW5pbmdcblx0XHRcdCRzY29wZS5jb21wbGV0ZWRDb3VudCA9IHRvdGFsIC0gcmVtYWluaW5nXG5cdFx0XHQkc2NvcGUuYWxsQ2hlY2tlZCA9IHJlbWFpbmluZyA9PSAwXG5cdFx0LCB0cnVlXG5cblx0XHQkc2NvcGUuYWRkU29uZyA9IC0+XG5cdFx0XHRuZXdTb25nID0gJHNjb3BlLm5ld1NvbmcudHJpbSgpXG5cdFx0XHRyZXR1cm4gaWYgbm90IG5ld1NvbmcubGVuZ3RoXG5cblx0XHRcdCRzY29wZS5zb25ncy4kYWRkXG5cdFx0XHRcdHRpdGxlOiBuZXdTb25nXG5cdFx0XHRcdGNvbXBsZXRlZDogZmFsc2VcblxuXHRcdFx0JHNjb3BlLm5ld1NvbmcgPSAnJ1xuXG5cdFx0JHNjb3BlLmVkaXRTb25nID0gKGlkKSAtPlxuXHRcdFx0cmV0dXJuIGlmIGlkID09ICRzY29wZS5wbGF5aW5nLnNvbmdJZFxuXG5cdFx0XHRlZGl0ZWRTb25nID0gJHNjb3BlLnNvbmdzW2lkXVxuXHRcdFx0cmV0dXJuIGlmIGVkaXRlZFNvbmcuY29tcGxldGVkXG5cblx0XHRcdCRzY29wZS5lZGl0ZWRTb25nID0gZWRpdGVkU29uZ1xuXHRcdFx0JHNjb3BlLm9yaWdpbmFsU29uZyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBlZGl0ZWRTb25nKVxuXG5cdFx0JHNjb3BlLmRvbmVFZGl0aW5nID0gKGlkKSAtPlxuXHRcdFx0JHNjb3BlLmVkaXRlZFNvbmcgPSBudWxsXG5cdFx0XHR0aXRsZSA9ICRzY29wZS5zb25nc1tpZF0udGl0bGUudHJpbSgpXG5cdFx0XHRpZiB0aXRsZVxuXHRcdFx0XHQkc2NvcGUuc29uZ3MuJHNhdmUoaWQpXG5cdFx0XHRlbHNlXG5cdFx0XHRcdCRzY29wZS5yZW1vdmVTb25nKGlkKVxuXG5cdFx0JHNjb3BlLnJldmVydEVkaXRpbmcgPSAoaWQpIC0+XG5cdFx0XHQkc2NvcGUuc29uZ3NbaWRdID0gJHNjb3BlLm9yaWdpbmFsU29uZ1xuXHRcdFx0JHNjb3BlLmRvbmVFZGl0aW5nKGlkKVxuXG5cdFx0JHNjb3BlLnJlbW92ZVNvbmcgPSAoaWQpIC0+XG5cdFx0XHQkc2NvcGUuc29uZ3MuJHJlbW92ZShpZClcblxuXHRcdCRzY29wZS50b2dnbGVDb21wbGV0ZWQgPSAoaWQpIC0+XG5cdFx0XHRzb25nID0gJHNjb3BlLnNvbmdzW2lkXVxuXHRcdFx0c29uZy5jb21wbGV0ZWQgPSBub3Qgc29uZy5jb21wbGV0ZWRcblx0XHRcdCRzY29wZS5zb25ncy4kc2F2ZShpZClcblxuXHRcdCRzY29wZS5uZXh0U29uZyA9IC0+XG5cdFx0XHQkc2NvcGUuc3RvcE11c2ljKClcblx0XHRcdGlkID0gJHNjb3BlLnBsYXlpbmc/LnNvbmdJZFxuXHRcdFx0c29uZyA9ICRzY29wZS5zb25nc1tpZF1cblx0XHRcdHNvbmcuY29tcGxldGVkID0gdHJ1ZSBpZiBzb25nXG5cblx0XHRcdHNldFRpbWVvdXQgLT5cblx0XHRcdFx0JHNjb3BlLnN0YXJ0TXVzaWMoKVxuXHRcdFx0XHQkc2NvcGUuJGFwcGx5KClcblx0XHRcdCwgMTAwMFxuXG5cdFx0JHNjb3BlLnN0YXJ0TXVzaWMgPSAtPlxuXHRcdFx0JHNjb3BlLnBsYXlpbmcuJGNoaWxkKCdzaG91bGRQbGF5JykuJHNldCh0cnVlKVxuXG5cdFx0JHNjb3BlLnN0b3BNdXNpYyA9IC0+XG5cdFx0XHQkc2NvcGUucGxheWluZy4kc2V0KHNob3VsZFBsYXk6IGZhbHNlKVxuXG5cdFx0JHNjb3BlLmNsZWFyQ29tcGxldGVkU29uZ3MgPSAtPlxuXHRcdFx0YW5ndWxhci5mb3JFYWNoICRzY29wZS5zb25ncy4kZ2V0SW5kZXgoKSwgKGlkKSAtPlxuXHRcdFx0XHRpZiAkc2NvcGUuc29uZ3NbaWRdLmNvbXBsZXRlZFxuXHRcdFx0XHRcdCRzY29wZS5zb25ncy4kcmVtb3ZlKGlkKVxuXG5cdFx0JHNjb3BlLm5ld1NvbmcgPSAnJ1xuXHRcdCRzY29wZS5lZGl0ZWRTb25nID0gbnVsbFxuXG5cdFx0JGxvY2F0aW9uLnBhdGgoJy8nKSBpZiAkbG9jYXRpb24ucGF0aCgpID09ICcnXG5cdFx0JHNjb3BlLmxvY2F0aW9uID0gJGxvY2F0aW9uXG5cblx0XHQjIEJpbmQgdGhlIHNvbmdzIHRvIHRoZSBmaXJlYmFzZSBwcm92aWRlci5cblx0XHQkc2NvcGUuc29uZ3MgPSAkZmlyZWJhc2UoZmlyZVJlZi5jaGlsZCgncGxheWxpc3QnKSlcblx0XHQkc2NvcGUucGxheWluZyA9ICRmaXJlYmFzZShmaXJlUmVmLmNoaWxkKCdwbGF5aW5nJykpXG5cblx0XHQjIE5lZWRlZCBmb3Igc3BlZWNoIHJlY29nbml0aW9uLlxuXG5cdFx0ZmluZFNvbmcgPSAodGl0bGUpIC0+XG5cdFx0XHQkc2NvcGUuc29uZ3MuJGdldEluZGV4KCkuZm9yRWFjaCAoaWQpIC0+XG5cdFx0XHRcdHNvbmcgPSAkc2NvcGUuc29uZ3NbaWRdXG5cdFx0XHRcdHJldHVybiBpZCBpZiBzb25nLnRpdGxlID09IHRpdGxlXG5cblx0XHRcdHJldHVyblxuXG5cdFx0Y29tcGxldGVTb25nID0gKHRpdGxlKSAtPlxuXHRcdFx0aWQgPSBmaW5kU29uZyh0aXRsZSlcblx0XHRcdHJldHVybiBpZiAhaWRcblxuXHRcdFx0c29uZyA9ICRzY29wZS5zb25nc1tpZF1cblx0XHRcdHNvbmcuY29tcGxldGVkID0gbm90IHNvbmcuY29tcGxldGVkXG5cdFx0XHQkc2NvcGUudG9nZ2xlQ29tcGxldGVkKGlkKVxuXHRcdFx0JHNjb3BlLiRhcHBseSgpXG5cblx0XHRcdHJldHVybiB0cnVlXG5cblx0XHRMQU5HID0gJ2VuLVVTJ1xuXHRcdCRzcGVlY2hSZWNvZ25pdGlvbi5vbnN0YXJ0IChlKSAtPlxuXHRcdFx0JHNwZWVjaFN5bnRoZXRpcy5zcGVhaygnV2hhdCBzb25ncyBkbyB5b3Ugd2FudCB0byBwbGF5PycsIExBTkcpXG5cblx0XHQkc3BlZWNoUmVjb2duaXRpb24ub25lcnJvciAoZSkgLT5cblx0XHRcdGVycm9yID0gZS5lcnJvciBvciAnJ1xuXHRcdFx0Y29uc29sZS5lcnJvcignQW4gZXJyb3Igb2NjdXJyZWQgJyArIGVycm9yKVxuXG5cdFx0JHNwZWVjaFJlY29nbml0aW9uLnBheUF0dGVudGlvbigpXG5cdFx0JHNwZWVjaFJlY29nbml0aW9uLnNldExhbmcoTEFORylcblx0XHQkc3BlZWNoUmVjb2duaXRpb24ubGlzdGVuKClcblxuXHRcdCRzcGVlY2hSZWNvZ25pdGlvbi5vblV0dGVyYW5jZSAodXR0ZXJhbmNlKSAtPlxuXHRcdFx0Y29uc29sZS5sb2codXR0ZXJhbmNlKVxuXG5cdFx0JHNjb3BlLnJlY29nbml0aW9uID0gcmVjb2duaXRpb24gPSB7fVxuXHRcdCRzY29wZS5yZWNvZ25pdGlvbltMQU5HXSA9XG5cdFx0XHRwbGF5U29uZzpcblx0XHRcdFx0cmVnZXg6IC9ecGxheSAuKy9naVxuXHRcdFx0XHRsYW5nOiBMQU5HXG5cdFx0XHRcdGNhbGw6ICh1dHRlcmFuY2UpIC0+XG5cdFx0XHRcdFx0cGFydHMgPSB1dHRlcmFuY2Uuc3BsaXQoJyAnKVxuXHRcdFx0XHRcdGlmIHBhcnRzLmxlbmd0aCA+IDFcblx0XHRcdFx0XHRcdCRzY29wZS5uZXdTb25nID0gcGFydHMuc2xpY2UoMSkuam9pbignICcpXG5cdFx0XHRcdFx0XHQkc2NvcGUuYWRkU29uZygpXG5cdFx0XHRcdFx0XHQkc2NvcGUuJGFwcGx5KClcblx0XHRcdHN0YXJ0TXVzaWM6XG5cdFx0XHRcdHJlZ2V4OiAvc3RhcnQuKm11c2ljL2dpXG5cdFx0XHRcdGxhbmc6IExBTkdcblx0XHRcdFx0Y2FsbDogKHV0dGVyYW5jZSkgLT5cblx0XHRcdFx0XHQkc2NvcGUuc3RhcnRNdXNpYygpXG5cdFx0XHRcdFx0JHNjb3BlLiRhcHBseSgpXG5cdFx0XHRzdG9wTXVzaWM6XG5cdFx0XHRcdHJlZ2V4OiAvc3RvcC4qbXVzaWMvZ2lcblx0XHRcdFx0bGFuZzogTEFOR1xuXHRcdFx0XHRjYWxsOiAodXR0ZXJhbmNlKSAtPlxuXHRcdFx0XHRcdCRzY29wZS5zdG9wTXVzaWMoKVxuXHRcdFx0XHRcdCRzY29wZS4kYXBwbHkoKVxuXHRcdFx0Y2xlYXJDb21wbGV0ZWQ6XG5cdFx0XHRcdHJlZ2V4OiAvY2xlYXIuKi9naVxuXHRcdFx0XHRsYW5nOiBMQU5HXG5cdFx0XHRcdGNhbGw6ICh1dHRlcmFuY2UpIC0+XG5cdFx0XHRcdFx0JHNjb3BlLmNsZWFyQ29tcGxldGVkU29uZ3MoKVxuXHRcdFx0XHRcdCRzY29wZS4kYXBwbHkoKVxuXHRcdFx0bmV4dDpcblx0XHRcdFx0cmVnZXg6IC9uZXh0LiovZ2lcblx0XHRcdFx0bGFuZzogTEFOR1xuXHRcdFx0XHRjYWxsOiAodXR0ZXJhbmNlKSAtPlxuXHRcdFx0XHRcdCRzY29wZS5uZXh0U29uZygpXG5cdFx0XHRcdFx0JHNjb3BlLiRhcHBseSgpXG5cdFx0XHRsaXN0VGFza3M6IFtcblx0XHRcdFx0cmVnZXg6IC9ecmVtb3ZlIC4rL2dpXG5cdFx0XHRcdGxhbmc6IExBTkcsXG5cdFx0XHRcdGNhbGw6ICh1dHRlcmFuY2UpIC0+XG5cdFx0XHRcdFx0IyBUT0RPOiBvbmx5IGRvIGZvciBub3QgY29tcGxldGVcblx0XHRcdFx0XHRwYXJ0cyA9IHV0dGVyYW5jZS5zcGxpdCgnICcpXG5cdFx0XHRcdFx0aWYgcGFydHMubGVuZ3RoID4gMVxuXHRcdFx0XHRcdFx0dGl0bGUgPSBwYXJ0c1sxLi4uXS5qb2luKCcgJylcblx0XHRcdFx0XHRcdGlkID0gZmluZFNvbmcodGl0bGUpXG5cdFx0XHRcdFx0XHRpZiBpZFxuXHRcdFx0XHRcdFx0XHQkc2NvcGUucmVtb3ZlU29uZyhpZClcblx0XHRcdFx0XHRcdFx0JHNjb3BlLiRhcHBseSgpXG5cdFx0XHRdXG5cblx0XHRpZ25vcmVVdHRlcmFuY2UgPSB7fVxuXHRcdGZvciBrLCB2IG9mIHJlY29nbml0aW9uW0xBTkddXG5cdFx0XHRjb250aW51ZSBpZiB2IGluc3RhbmNlb2YgQXJyYXlcblxuXHRcdFx0aWdub3JlVXR0ZXJhbmNlW2tdID0gJHNwZWVjaFJlY29nbml0aW9uLmxpc3RlblV0dGVyYW5jZSh2KVxuIl19
